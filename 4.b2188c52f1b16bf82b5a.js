(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"74/6":function(e,t,s){"use strict";s.r(t),s.d(t,"UsersModule",(function(){return G}));var r=s("ofXK"),n=s("tyNb"),i=s("lJxs"),a=s("2Vo4"),c=s("itXk"),o=function(e){return e.UserSave="user-save",e.UsersLoading="users-loading",e}({});let l=new a.a(null);const u=e=>{l.next(e)};var b=s("fXoL"),g=s("mrSG"),d=s("IzEk"),f=s("tk/3"),p=s("4ZtF");let h=(()=>{let e=class extends p.b{constructor(){super({users:[]})}};return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=b.Gb({token:e,factory:e.\u0275fac,providedIn:"root"}),e=Object(g.b)([Object(p.c)({name:"users",resettable:!0})],e),e})(),v=(()=>{class e extends p.a{constructor(e){super(e),this.store=e}get users$(){return this.select("users")}}return e.\u0275fac=function(t){return new(t||e)(b.Tb(h))},e.\u0275prov=b.Gb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var m=s("LRne"),U=s("3E0/"),z=s("vkgz");let O=(()=>{class e{constructor(e){this.usersStore=e}createUserRequest(e){const t=this.usersStore.getValue();return Object(m.a)("CREATE").pipe(Object(U.a)(1500),Object(z.a)(()=>{this.usersStore.update({users:t.users.concat(Object.assign(Object.assign({},e),{guid:t.users.length+1}))})}))}saveUserRequest(e){const t=this.usersStore.getValue();return Object(m.a)("SAVE").pipe(Object(U.a)(1500),Object(z.a)(()=>{this.usersStore.update({users:t.users.map(t=>t.guid===e.guid?e:t)})}))}deleteUserRequest(e){const t=this.usersStore.getValue();return Object(m.a)("DELETE").pipe(Object(U.a)(1500),Object(z.a)(()=>{this.usersStore.update({users:t.users.filter(t=>t.guid!==e)})}))}}return e.\u0275fac=function(t){return new(t||e)(b.Tb(h))},e.\u0275prov=b.Gb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),P=(()=>{class e{constructor(e,t,s,r){this.http=e,this.usersQuery=t,this.usersStore=s,this.requestService=r}get users$(){return this.usersQuery.users$.pipe(Object(i.a)(e=>this.performUsers(e)))}initUsers(){return Object(g.a)(this,void 0,void 0,(function*(){const e=yield this.fetchUsers().pipe(Object(d.a)(1)).toPromise();this.usersStore.update({users:e})}))}fetchUsers(){return this.http.get("assets/mates.json")}performUsers(e){return e.map(e=>Object.assign(Object.assign({},e),{avatar:"assets/avatar.png",summary:`${e.name.first.substr(0,1)}.${e.name.last.substr(0,1)} ${e.email}`}))}createUser(e){return this.requestService.createUserRequest(e)}saveUser(e){return this.requestService.saveUserRequest(e)}deleteUser(e){return this.requestService.deleteUserRequest(e)}}return e.\u0275fac=function(t){return new(t||e)(b.Tb(f.b),b.Tb(v),b.Tb(h),b.Tb(O))},e.\u0275prov=b.Gb({token:e,factory:e.\u0275fac}),e})();var C=s("dPPq"),y=s("OzZK"),S=s("RwU8"),M=s("+oEP"),j=s("C2AL"),w=s("PTRe"),V=s("3Pt+"),$=s("B+r4"),_=s("ocnv"),R=s("tAs6"),T=s("FwiY");function k(e,t){if(1&e){const e=b.Qb();b.Pb(0,"button",9),b.Xb("click",(function(){return b.oc(e),b.ac(3).resetFilters()})),b.zc(1," Reset filters "),b.Lb(2,"i",10),b.Ob()}2&e&&b.gc("nzBlock",!0)}function x(e,t){if(1&e){const e=b.Qb();b.Pb(0,"div",3),b.Pb(1,"div",4),b.Pb(2,"input",5),b.Xb("ngModelChange",(function(t){return b.oc(e),b.ac().init.filter.search=t}))("ngModelChange",(function(t){b.oc(e);const s=b.ac().init;return b.ac().updateFilters("search",t,s.filter)})),b.Ob(),b.Ob(),b.Pb(3,"div",4),b.Pb(4,"nz-form-label",6),b.zc(5," Age "),b.Ob(),b.Pb(6,"nz-slider",7),b.Xb("ngModelChange",(function(t){return b.oc(e),b.ac(2).rangeValue=t}))("nzOnAfterChange",(function(t){b.oc(e);const s=b.ac().init;return b.ac().updateFilters("ageRange",t,s.filter)})),b.Ob(),b.Ob(),b.xc(7,k,3,1,"button",8),b.Ob()}if(2&e){const e=b.ac().init,t=b.ac();b.zb(2),b.gc("nzSize","large")("ngModel",e.filter.search),b.zb(2),b.gc("nzSm",6)("nzXs",24),b.zb(2),b.gc("nzStep",1)("ngModel",t.rangeValue),b.zb(1),b.gc("ngIf",!!e.filter.search||!!e.filter.ageRange.length)}}function E(e,t){if(1&e){const e=b.Qb();b.Nb(0),b.Pb(1,"button",1),b.Xb("nzPopoverVisibleChange",(function(t){return b.oc(e),b.ac().isFiltersVisible=t})),b.zc(2," Filters "),b.Ob(),b.xc(3,x,8,7,"ng-template",null,2,b.yc),b.Mb()}if(2&e){const e=b.nc(4),t=b.ac();b.zb(1),b.gc("nzPopoverVisible",t.isFiltersVisible)("nzPopoverPlacement","bottomLeft")("nzPopoverContent",e)}}const q=function(e){return{filter:e}};let F=(()=>{class e{constructor(){this.isFiltersVisible=!1,this.rangeValue=[10,50],this.filtersValueChange$=new a.a({search:"",ageRange:[]})}ngOnInit(){}updateFilters(e,t,s){s[e]=t,this.filtersValueChange$.next(s),console.log(this.filtersValueChange$.getValue())}resetFilters(){this.filtersValueChange$.next({search:"",ageRange:[]})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=b.Eb({type:e,selectors:[["app-table-filter"]],outputs:{filtersValueChange$:"filtersValueChange$"},decls:2,vars:5,consts:[[4,"init"],["nz-popover","","nzPopoverTitle","Filters","nzPopoverTrigger","click","nz-button","","nzType","default",3,"nzPopoverVisible","nzPopoverPlacement","nzPopoverContent","nzPopoverVisibleChange"],["contentTemplate",""],[1,"filters"],[1,"filters__row"],["nz-input","","placeholder","Search",3,"nzSize","ngModel","ngModelChange"],[3,"nzSm","nzXs"],["nzRange","",1,"filters_slider",3,"nzStep","ngModel","ngModelChange","nzOnAfterChange"],["class","filters_reset-button","nz-button","","nzType","default",3,"nzBlock","click",4,"ngIf"],["nz-button","","nzType","default",1,"filters_reset-button",3,"nzBlock","click"],["nz-icon","","nzType","reload","nzTheme","outline"]],template:function(e,t){1&e&&(b.xc(0,E,5,3,"ng-container",0),b.bc(1,"async")),2&e&&b.gc("init",b.jc(3,q,b.cc(1,1,t.filtersValueChange$)))},directives:[C.b,y.a,S.a,M.a,j.a,w.a,V.d,V.l,V.n,$.a,_.d,R.a,r.l,T.a],pipes:[r.b],styles:[".filters[_ngcontent-%COMP%]{width:256px}.filters__row[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;margin-bottom:16px}.filters__row[_ngcontent-%COMP%]:last-of-type, .filters__row[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:0}.filters_slider[_ngcontent-%COMP%]{width:100%}.filters_reset-button[_ngcontent-%COMP%]{margin-top:16px}"]}),e})();var L=s("i5rD"),X=s("+UDI");function I(e,t){if(1&e){const e=b.Qb();b.Nb(0),b.Pb(1,"app-table-filter",1),b.Xb("filtersValueChange$",(function(t){return b.oc(e),b.ac().tableFilters$.next(t)})),b.Ob(),b.Pb(2,"app-users-table",2),b.Xb("createUser",(function(){return b.oc(e),b.ac().createUser()}))("editUser",(function(t){return b.oc(e),b.ac().editUserHandler(t)}))("deleteUser",(function(t){return b.oc(e),b.ac().deleteUser(t)})),b.Ob(),b.Pb(3,"app-user-edit-modal",3),b.Xb("closeModal",(function(){return b.oc(e),b.ac().closeEditModal()}))("saveUser",(function(s){b.oc(e);const r=t.init;return b.ac().saveUser(s,r.editableUser)})),b.Ob(),b.Mb()}if(2&e){const e=t.init,s=b.ac();b.zb(2),b.gc("usersList",e.users),b.zb(1),b.gc("isVisible",!!e.editableUser||s.isCreateUserModal)("editableUser",e.editableUser)("isLoading",e.loading===s.loadingEventTypes.UserSave)}}const A=function(e,t,s){return{users:e,editableUser:t,loading:s}},N=[{path:"",component:(()=>{class e{constructor(e,t,s){this.usersService=e,this.router=t,this.activatedRoute=s,this.tableFilters$=new a.a({search:"",ageRange:[]}),this.users$=Object(c.a)([this.usersService.users$,this.tableFilters$]).pipe(Object(i.a)(([e,t])=>{let s=e;return t.search&&(s=s.filter(e=>`${e.name.first} ${e.name.last}`.toLocaleLowerCase().match(t.search.toLocaleLowerCase()))),t.ageRange.length&&(s=s.filter(e=>{return(r=t.ageRange)[0]<=(s=e.age)&&s<=r[1];var s,r})),s})),this.loading$=l,this.loadingEventTypes=o,this.editableUser$=Object(c.a)([this.users$,this.activatedRoute.queryParamMap]).pipe(Object(i.a)(([e,t])=>e.find(e=>e.guid.toString()===t.get("user")))),this.isCreateUserModal=!1}ngOnInit(){this.usersService.initUsers()}createUser(){this.isCreateUserModal=!0}editUserHandler(e){this.router.navigate([],{queryParams:{user:e.guid},queryParamsHandling:"merge"})}closeEditModal(){this.router.navigate([],{queryParams:{user:null},queryParamsHandling:"merge"}),this.isCreateUserModal=!1}saveUser(e,t){let s;t?(s=Object.assign(Object.assign({},t),{name:{first:e.firstName,last:e.lastName},age:e.age}),u(o.UserSave),this.usersService.saveUser(s).subscribe(()=>{u(null),this.closeEditModal()})):(s={email:e.email,name:{first:e.firstName,last:e.lastName},age:e.age},u(o.UserSave),this.usersService.createUser(s).subscribe(()=>{u(null),this.closeEditModal()}))}deleteUser(e){this.usersService.deleteUser(e.guid).subscribe()}}return e.\u0275fac=function(t){return new(t||e)(b.Kb(P),b.Kb(n.c),b.Kb(n.a))},e.\u0275cmp=b.Eb({type:e,selectors:[["app-users"]],decls:4,vars:11,consts:[[4,"init"],[1,"users__filter",3,"filtersValueChange$"],[3,"usersList","createUser","editUser","deleteUser"],[3,"isVisible","editableUser","isLoading","closeModal","saveUser"]],template:function(e,t){1&e&&(b.xc(0,I,4,4,"ng-container",0),b.bc(1,"async"),b.bc(2,"async"),b.bc(3,"async")),2&e&&b.gc("init",b.lc(7,A,b.cc(1,1,t.users$),b.cc(2,3,t.editableUser$),b.cc(3,5,t.loading$)))},directives:[C.b,F,L.a,X.a],pipes:[r.b],styles:[".users__filter[_ngcontent-%COMP%]{display:block;margin-bottom:16px}"]}),e})()}];let H=(()=>{class e{}return e.\u0275mod=b.Ib({type:e}),e.\u0275inj=b.Hb({factory:function(t){return new(t||e)},imports:[[n.f.forChild(N)],n.f]}),e})();var Q=s("j1ZV");let G=(()=>{class e{}return e.\u0275mod=b.Ib({type:e}),e.\u0275inj=b.Hb({factory:function(t){return new(t||e)},providers:[P],imports:[[r.c,H,Q.a,C.c]]}),e})()}}]);